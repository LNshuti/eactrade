---
title: "README"
output: html_document
---

```{r setup, include=FALSE}
repo_ <- "eactrade"
source(paste0(repo_, "/R/manifest.R"))
```

```{r}
# Location corresponds to the importing entity(receiving country)
# Partner_id corresponds to the exporting entity
# Product ID is a unique identifier from the Harvard Wits database
dfeac_productname_partner_id <- 
  read_rds("eactrade/data/processed/eac_trade_df_2015_2019.rds") %>%
  mutate(import_value = as.numeric(import_value), 
         export_value = as.numeric(export_value)#,
         #location_product = paste0(location_id,"_", product_id)# ,
         #partner_year = paste0(partner_id, "_", year)
         ) %>%
  select(from, to, product_id, year, import_value, export_value) %>%
  #select(location_product, partner_year, import_value, export_value) %>%
  group_by(from, to, product_id) %>%
  summarise(imports = sum(import_value, na.rm = TRUE), 
            exports = sum(export_value, na.rm = TRUE)) %>%
  
  ungroup() %>%
  mutate(trade_bal = exports- imports) %>%
  unique() 

eac_tradebal_bp <-  
  dfeac_productname_partner_id %>%
  select(from, to, weight = imports) %>%
  as_tbl_graph(directed = TRUE)
  
ggraph(eac_tradebal_bp) +
  geom_edge_link() +
  geom_node_label(aes(label = name))

```


```{r}
ggraph_df <- 
  dfeac_productname_partner_id %>% 
  select(-exports) %>%
  graph_from_data_frame(.)

ggraph(ggraph_df, layout = 'fr', weights = "weight") + 
  geom_edge_link() + 
  geom_node_point()


g1 <- graph.adjacency(cor1$r, weighted=TRUE, mode="lower")
g1 <- delete.edges(g1, E(g1)[ abs(weight) < 0.3 ])
plot.igraph(g1, vertex.size=20, edge.width=abs(E(g1)$weight)*8, 
        edge.color=ifelse(cor1$r > 0, "blue","red"))
```
