---
title: "README"
output: html_document
---

```{r setup, include=FALSE}
repo_ <- "eactrade"
source(paste0(repo_, "/R/manifest.R"))
```

```{r}
# Location corresponds to the importing entity(receiving country)
# Partner_id corresponds to the exporting entity
# Product ID is a unique identifier from the Harvard Wits database

dfeac_productname_partner_id <- 
  read_rds("eactrade/data/processed/eac_trade_df_2015_2019.rds") %>%
  filter(location_id != partner_id) %>%
  mutate(import_value = as.numeric(import_value), 
         export_value = as.numeric(export_value),
            location_product = paste0(location_id,"_", product_id),
            partner_year = paste0(location_id, "_", product_id)) %>%
  head(100) %>% 
  select(location_product, partner_year, import_value, export_value) %>%
  group_by(location_product, partner_year) %>%
  summarise(imports = sum(import_value, na.rm = TRUE), 
            exports = sum(export_value, na.rm = TRUE)) %>%
  
  ungroup() %>%
  unique()
  
eac_imports_bp <-  
  dfeac_productname_partner_id %>%
  pivot_wider(id_cols = location_product,
              names_from = partner_year, 
              values_from = c("imports")) %>%
  convert_to_bipartite(id = location_product)

eac_exports_bp <-  
  dfeac_productname_partner_id %>%
  pivot_wider(id_cols = location_product,
              names_from = partner_year, 
              values_from = c("exports")) %>%
  convert_to_bipartite(id = location_product)

eac_imports_bp[is.na(eac_imports_bp)] <- 0
eac_exports_bp[is.na(eac_exports_bp)] <- 0

eac_imports_up <-eac_imports_bp %*% t(eac_imports_bp)
eac_exports_up <-eac_exports_bp %*% t(eac_exports_bp)
# 
# nodes_eac_products <-
#   as_tbl_graph(up_eac_products) %>%
#   activate(nodes) %>%
#   as_tibble()
# 
# edges_eac_products <- 
#   as_tbl_graph(up_eac_products) %>%
#   activate(edges) %>%
#   as_tibble()
```


```{r}
ggraph(up_eac_products, 'stress') + 
  geom_node_voronoi(aes(fill = group), max.radius = 1) + 
  geom_node_point() + 
  geom_edge_link() + 
  coord_fixed()
```