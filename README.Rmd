---
title: "README"
output: html_document
---

```{r setup, include=FALSE}
repo_ <- "eactrade"
source(paste0(repo_, "/R/manifest.R"))
```

```{r}
dfeac_productname_partner_id <- 
  read_rds("eactrade/data/processed/eac_trade_df_2015_2019.rds") %>%
  mutate(import_value = as.numeric(import_value)) %>%
  head(1000) %>% 
  group_by(partner_id, product_id, year) %>%
  summarise(imports = sum(import_value, na.rm = TRUE)) %>%
  ungroup() %>%
  rowwise() %>%
  mutate(partner_id_pad = str_pad(paste0(partner_id, 
                                         product_id,
                                         sample.int(1000, 1)),
                                  width = 11, pad = "0", side = "right")
         ) %>%
  ungroup() %>%
  unique() 
  
dfeac_bipartite <-  
  dfeac_productname_partner_id %>%
  pivot_wider(id_cols =  c("year", "product_id"),
              names_from = partner_id_pad, 
              values_from = c("imports")) %>%
  mutate(year_product = paste0(year, product_id)) %>%
  select(-year, -product_id) %>%
  convert_to_bipartite(id = year_product)

dfeac_bipartite[is.na(dfeac_bipartite)] <- 0

up_eac_products <-dfeac_bipartite %*% t(dfeac_bipartite)

graph_eac_products <- as_tbl_graph(up_eac_products)

```


```{r}
ggraph(tn_contig_graph_adj_noloops, 'stress') + 
  geom_node_voronoi(aes(fill = group), max.radius = 1) + 
  geom_node_point() + 
  geom_edge_link() + 
  coord_fixed()
```