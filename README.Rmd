---
title: "README"
output: html_document
---

```{r setup, include=FALSE}
repo_ <- "eactrade"
source(paste0(repo_, "/R/manifest.R"))
```

```{r}
# Location corresponds to the importing entity(receiving country)
# Partner_id corresponds to the exporting entity
# Product ID is a unique identifier from the Harvard Wits database
dfeac_productname_partner_id <- 
  read_rds("eactrade/data/processed/eac_trade_df_2015_2019.rds") %>%
  mutate(import_value = as.numeric(import_value), 
         export_value = as.numeric(export_value)#,
         #location_product = paste0(location_id,"_", product_id)# ,
         #partner_year = paste0(partner_id, "_", year)
         ) %>%
  select(from, to, product_id, year, import_value, export_value) %>%
  #select(location_product, partner_year, import_value, export_value) %>%
  group_by(from, to, product_id) %>%
  summarise(imports = sum(import_value, na.rm = TRUE), 
            exports = sum(export_value, na.rm = TRUE)) %>%
  ungroup() %>%
  #mutate(trade_bal = exports- imports) %>%
  unique() 
```


```{r}
library(igraph)
library(graphlayouts)
library(gridExtra)

set.seed(123987)
eac_tradebal_bp <-  
  dfeac_productname_partner_id %>%
  filter(exports > 0 & imports > 0) %>%
  select(from, to, imports) %>%
  sample_n(100) %>%
  as_tbl_graph(directed = TRUE) 

unweighted_graph <- 
  ggraph(eac_tradebal_bp, layout = "dh") +
  geom_edge_link0(aes(edge_width = imports), edge_colour = "grey66") +
  geom_node_label(aes(label = name), family = "serif", repel = TRUE) +
  geom_edge_link(alpha = .25) +
  scale_edge_width_continuous() +
  theme_graph() + 
  labs(label = "") +
  theme(legend.position = "bottom")

ggsave(unweighted_graph,
       filename = paste0(repo_, "/outputs/unweighted_graph.png"), 
       width = 4, height = 4)

countries_xw <- 
  read_csv(paste0(repo_, "/data/countries_codes_and_coordinates.csv")) %>% 
  janitor::clean_names() %>%
  select(country_code = alpha_3_code, country) %>%
  filter(alpha_3_code %in% c("COM", "AGO", "ERI", "BWA", "CPV", "CAF", 
                             "CMR", "GNQ", "TCD", "ETH", "COD")) 
  
combined_plt <- 
  grid.arrange(unweighted_graph,
               tableGrob(countries_xw, rows = NULL), 
               heights=c(0.7, 0.3), nrow=2)
```
