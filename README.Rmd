---
title: "README"
output: html_document
---

```{r setup, include=FALSE}
repo_ <- "eactrade"
source(paste0(repo_, "/R/manifest.R"))
```

```{r}
bp_productname_partner_id <- 
  read_rds("eactrade/data/processed/eac_trade_df_2015_2019.rds") %>%
  head(1000) %>% 
  rowwise() %>%
  mutate(partner_id_pad = str_pad(paste0(partner_id, sample.int(1000, 1)),
                                  width = 11, pad = "0", side = "right")) %>%
  ungroup() %>%
  unique() %>%
  select(partner_id_pad, product_id, import_value, year) %>%
  spread(partner_id_pad, import_value) %>%
  convert_to_bipartite(id = product_id)

bp_productname_partner_id[is.na(bp_productname_partner_id)] <- 0

up_products <-bp_productname_partner_id %*% t(bp_productname_partner_id)

tn_contig_graph_adj_noloops <- 
  graph_from_adjacency_matrix(up_products, weighted = TRUE) %>%
  simplify(., remove.loops = TRUE)

summary(tn_contig_graph_adj_noloops)

```


```{r}
ggraph(tn_contig_graph_adj_noloops, 'stress') + 
  geom_node_voronoi(aes(fill = group), max.radius = 1) + 
  geom_node_point() + 
  geom_edge_link() + 
  coord_fixed()
```